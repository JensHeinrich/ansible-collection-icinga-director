---
- name: create everything
  hosts: localhost
  tasks:
    - include_role:
        name: "icinga"
        tasks_from: "{{ item }}"
  loop:
    - absent_icinga_service.yml
    - absent_icinga_host.yml
    - absent_icinga_host_template.yml
    - absent_icinga_hostgroup.yml
    - absent_icinga_service_apply.yml
    - absent_icinga_service_template.yml
    - absent_icinga_servicegroup.yml
    - absent_icinga_hostgroup.yml
    - absent_icinga_notification.yml
    - absent_icinga_notification_template.yml
    - absent_icinga_endpoint.yml
    - absent_icinga_zone.yml
    - absent_icinga_user.yml
    - absent_icinga_user_template.yml
    - absent_icinga_timeperiod.yml
    - absent_icinga_command.yml
    - absent_icinga_command_template.yml

- name: deploy changes in icinga
  tags: uri
  uri:
    url: "{{ icinga_url }}/director/config/deploy"
    headers:
      Accept: application/json
    method: POST
    user: "{{ icinga_user }}"
    password: "{{ icinga_pass }}"
    return_content: true
